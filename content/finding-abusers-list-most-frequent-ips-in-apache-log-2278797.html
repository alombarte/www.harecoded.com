+++
date = "2013-06-25 07:53:00"
author = "alombarte"
title = "Finding abusers. List of most frequent IPs in Apache log"
slug = "finding-abusers-list-most-frequent-ips-in-apache-log-2278797"
tags = [ "apache","bash","shell","tricks" ]
+++
<p>
  Internet is full of malware and people with leisure time who will
  hammer your server with no good intentions, most of them will try
  to access well-known URLs looking for exploits of software like
  Wordpress (<em>/wp-admin.php</em>, <em>/edit</em>, etc...).
</p>
<p>
  If you monitor for a while your <em>access_log</em> it's easy to
  find out unwanted behaviour. If you want to get a list of the
  <strong>most frequent IPs in your Apache log</strong>&nbsp;the
  following command will get a list of those IPs sorted by number
  of requests:
</p>
<pre>
[root@www3 ~]# cat /var/log/httpd/access_log_20130620 | awk '{print $1}' | sort | uniq -c | sort -rn | head
 912545 95.27.xx.xx
  85151 66.249.78.72
  70448 66.249.78.139
  59450 95.27.40.10
  49649 178.121.54.212
  48295 91.203.166.250
  37894 157.56.92.165
  37028 157.56.92.152
  36094 157.56.93.62
  20707 157.55.32.87
</pre>
<p>
  Many of these IPs are bots like Google (66.249.xx.xx) or MSN
  (157.56.xx.xx) and they should be let in and out at their will.
  But as you can see in the first sample line, there is sometimes
  IPs that are not recognized bots that have a surprisingly high
  traffic over your network.
</p>
<p>
  If you want to identify these IPs use the service <a href=  "http://whois.net">whois.net</a>&nbsp;or install the bind-utils
  so you can use the "host" command and see the reverse DNS.
  Example:
</p>
<pre>
$ host 66.249.78.72<br>72.78.249.66.in-addr.arpa domain name pointer crawl-66-249-78-72.<strong>googlebot</strong>.com.
</pre>
<p>
  Any IP not having a reverse DNS, chances are it is someone
  playing nasty. If you detect that these IPs are abusing your
  system you can always block their access:
</p>
<pre>
iptables -I INPUT -s 95.27.xx.xx -j DROP
</pre>
<p>
  But this is not a permanent or desired solution at all. If you
  see this to happen a lot then you might need something more
  generic, like limiting the connections to the machine (caution
  with Bots!!). This is also helpful for some dDoS attacks.
  Example:
</p>
<pre>
iptables -A INPUT -p tcp --dport 80 -m limit --limit 25/minute --limit-burst 100 -j ACCEPT
</pre>
<p>
  To better understand limits see this limits-mo<a class="thickbox"  href=  "/img/posts/51c95cc5b946bs19849.jpg"  alt=" TAGS:" align="right"></a>dule&nbsp;<a href=  "http://thelowedown.wordpress.com/2008/07/03/iptables-how-to-use-the-limits-module/">article</a>.
</p>
<p>
  Finally, at Obolog we use a fantastic tool called <a href=  "http://goaccess.prosoftcorp.com/">GoAccess</a> that analyzes
  your logs and presents the information in a good looking format.
  See the screenshot:
</p>